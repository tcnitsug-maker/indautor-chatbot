<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel Administrativo INDARELÍN</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial; background:#eef1f6; margin:0; padding:20px; }
.hidden { display:none; }
#loginBox { max-width:350px; margin:100px auto; background:white; padding:20px; border-radius:8px; box-shadow:0 6px 20px rgba(0,0,0,0.2); }
#loginBox input { width:100%; padding:10px; margin-top:10px; }
#loginBox button { width:100%; padding:10px; background:#0b61ff; color:white; border:none; cursor:pointer; margin-top:10px; }
#adminPanel { display:none; }
table { width:100%; border-collapse:collapse; background:white; margin-top:20px; }
th,td { padding:10px; border-bottom:1px solid #ccc; }
th { background:#f2f2f2; }
.actions button { margin-right:6px; }
#editModal { position:fixed; inset:0; background:rgba(0,0,0,0.5); display:none; justify-content:center; align-items:center; }
.modal-content { background:white; padding:20px; width:400px; border-radius:8px; }
</style>
</head>
<body>
<div id="loginBox">
  <h2>Acceso Administrador</h2>
  <p>Ingresa la contraseña:</p>
  <input type="password" id="passInput">
  <button onclick="login()">Entrar</button>
  <p id="loginError" style="color:red;display:none;">Contraseña incorrecta</p>
</div>

<div id="adminPanel">
  <h1>Panel Administrativo</h1>
  <button onclick="loadData()">Actualizar</button>
  <table>
    <thead><tr><th>#</th><th>Pregunta</th><th>Respuesta</th><th>Origen</th><th>Fecha</th><th>Acciones</th></tr></thead>
    <tbody id="tbody"></tbody>
  </table>
</div>

<div id="editModal">
  <div class="modal-content">
    <h3>Editar Respuesta</h3>
    <p id="modalPregunta"></p>
    <textarea id="modalRespuesta" style="width:100%;height:100px;"></textarea><br><br>
    <button onclick="closeModal()">Cancelar</button>
    <button onclick="saveEdit()">Guardar</button>
  </div>
</div>

<script>
const API = "https://indautor-chatbot-1.onrender.com/api";
let PASS = null;
let editId = null;

function login() {
  PASS = document.getElementById("passInput").value.trim();
  fetch(API + "/admin/respuestas", { headers: { "x-admin-pass": PASS } })
  .then(r => {
    if (r.status === 401) { document.getElementById("loginError").style.display="block"; return; }
    document.getElementById("loginBox").style.display="none";
    document.getElementById("adminPanel").style.display="block";
    loadData();
  });
}

async function loadData() {
  const res = await fetch(API + "/admin/respuestas", { headers:{ "x-admin-pass": PASS }});
  const data = await res.json();
  const tbody = document.getElementById("tbody");
  tbody.innerHTML="";
  data.forEach((item,i)=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${i+1}</td>
      <td>${item.pregunta}</td>
      <td>${item.respuesta_manual || item.respuesta_ai}</td>
      <td>${item.origen}</td>
      <td>${new Date(item.fecha).toLocaleString()}</td>
      <td class="actions">
        <button onclick="openEdit('${item._id}','${item.pregunta}','${item.respuesta_manual || item.respuesta_ai}')">Editar</button>
        <button onclick="deleteItem('${item._id}')" style="background:#e33;color:white;">Eliminar</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

function openEdit(id,pregunta,respuesta){
  editId=id;
  document.getElementById("modalPregunta").textContent=pregunta;
  document.getElementById("modalRespuesta").value=respuesta;
  document.getElementById("editModal").style.display="flex";
}

function closeModal(){ document.getElementById("editModal").style.display="none"; }

async function saveEdit(){
  const newResp=document.getElementById("modalRespuesta").value;
  await fetch(API+"/admin/respuestas/"+editId,{
    method:"PUT",
    headers:{ "Content-Type":"application/json","x-admin-pass":PASS },
    body:JSON.stringify({ respuesta_manual:newResp })
  });
  closeModal(); loadData();
}

async function deleteItem(id){
  if(!confirm("¿Eliminar?")) return;
  await fetch(API+"/admin/respuestas/"+id,{ method:"DELETE", headers:{ "x-admin-pass":PASS }});
  loadData();
}
</script>
</body>
</html>
