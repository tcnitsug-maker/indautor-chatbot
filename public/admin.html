<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Panel Administrativo INDAREL칈N</title>

<link rel="stylesheet" href="admin.css" />

<!-- LEAFLET MAP -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<!-- CHART JS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>

<header>
  <h1>游늵 Panel Administrativo INDAREL칈N</h1>
</header>

<div id="navbar">
  <button data-tab="dashboard">游늳 Dashboard</button>
  <button data-tab="ips">游깴 IPs & Geolocalizaci칩n</button>
  <button data-tab="ipHistory">游닆 Historial por IP</button>
  <button data-tab="messages">游눫 Historial General</button>
  <button data-tab="custom">游 Respuestas Personalizadas</button>
  <button data-tab="users" id="usersTabBtn" style="display:none;">游논 Usuarios</button>
</div>

<main>

  <!-- DASHBOARD -->
  <section id="dashboard" class="tab-content active">
    <h2>游늵 Dashboard General</h2>

    <div class="cards">

      <div class="card">
        <h3>Total Mensajes</h3>
        <p id="totalMessages">0</p>
      </div>

      <div class="card">
        <h3>Total IPs 칔nicas</h3>
        <p id="totalIPs">0</p>
      </div>

      <div class="card">
        <h3>Consultas Hoy</h3>
        <p id="todayMessages">0</p>
      </div>

    </div>

    <canvas id="trafficChart"></canvas>
  </section>

  <!-- IP LIST -->
  <section id="ips" class="tab-content">
    <h2>游깴 IPs Conectadas</h2>
    <div id="map" style="height: 400px; margin-bottom: 20px;"></div>

    <table>
      <thead>
        <tr>
          <th>IP</th>
          <th>Mensajes</th>
          <th>칔ltima vez</th>
          <th>Ciudad</th>
          <th>Pa칤s</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="ipTable"></tbody>
    </table>
  </section>

  <!-- IP HISTORY -->
  <section id="ipHistory" class="tab-content">
    <h2>游닆 Historial por IP</h2>
    <input type="text" placeholder="Escribe IP..." id="ipSearch" />
    <button onclick="loadIPHistory()">Buscar</button>
    <div id="ipHistoryBox"></div>
  </section>

  <!-- ORIGINAL MESSAGE HISTORY -->
  <section id="messages" class="tab-content">
    <h2>游눫 Historial General</h2>
    <table>
      <thead>
        <tr><th>Rol</th><th>Mensaje</th><th>Fecha</th></tr>
      </thead>
      <tbody id="generalHistory"></tbody>
    </table>
  </section>

  <!-- CUSTOM REPLIES (OLD PANEL) -->
  <section id="custom" class="tab-content">
    <h2>游 Respuestas Personalizadas</h2>

    <div class="card">
      <input id="qInput" placeholder="Pregunta" />
      <textarea id="aInput" placeholder="Respuesta"></textarea>
      <input id="kInput" placeholder="Palabras clave (coma separadas)" />
      <button onclick="addCustom()">Agregar</button>
    </div>

    <table>
      <thead>
        <tr><th>Pregunta</th><th>Respuesta</th><th>Keywords</th><th>Eliminar</th></tr>
      </thead>
      <tbody id="customTable"></tbody>
    </table>
  </section>

  <!-- USERS (solo SUPER) -->
  <section id="users" class="tab-content">
    <h2>游논 Usuarios Administradores</h2>

    <div class="card">
      <h3>Crear usuario</h3>
      <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
        <input id="newUser" placeholder="Usuario" style="min-width:200px;" />
        <input id="newPass" type="password" placeholder="Contrase침a" style="min-width:200px;" />
        <select id="newRole" style="min-width:180px;">
          <option value="support">Support</option>
          <option value="analyst">Analyst</option>
          <option value="editor">Editor</option>
          <option value="super">Super</option>
        </select>
        <button onclick="createAdminUser()">Crear</button>
      </div>
      <p style="opacity:.75;margin-top:8px;">* Solo <b>Super</b> puede ver y administrar usuarios.</p>
    </div>

    <table>
      <thead>
        <tr>
          <th>Usuario</th>
          <th>Rol</th>
          <th>Activo</th>
          <th>Creado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="usersTable"></tbody>
    </table>
  </section>

</main>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="admin.js"></script>

</body>
</html>
