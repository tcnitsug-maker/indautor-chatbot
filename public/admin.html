<!DOCTYPE html>
<html lang="es">
<button onclick="logout()">Cerrar sesiÃ³n</button>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Panel Administrativo INDARELÃN</title>

<link rel="stylesheet" href="admin.css" />

<!-- LEAFLET MAP -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<!-- CHART JS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const token = localStorage.getItem("admin_token");

// âŒ Si no hay token â†’ regresar a login
if (!token) {
  window.location.replace("/admin-login.html");
}
</script>
  const API_BASE = "";

function authHeaders() {
  const token = localStorage.getItem("admin_token");
  return {
    "Content-Type": "application/json",
    "Authorization": "Bearer " + token
  };
}

// Ejemplo: cargar mensajes
async function loadMessages() {
  const res = await fetch("/admin/messages", {
    headers: authHeaders()
  });

  if (res.status === 401 || res.status === 403) {
    logout();
    return;
  }

  const data = await res.json();
  console.log(data);
}

// Logout
function logout() {
  localStorage.removeItem("admin_token");
  localStorage.removeItem("admin_user");
  localStorage.removeItem("admin_role");
  window.location.href = "/admin-login.html";
}
</head>
<body>

<header>
  <h1>ğŸ“Š Panel Administrativo INDARELÃN</h1>
</header>

<div id="navbar">
  <button data-tab="dashboard">ğŸ“ˆ Dashboard</button>
  <button data-tab="ips">ğŸŒ IPs & GeolocalizaciÃ³n</button>
  <button data-tab="ipHistory">ğŸ“œ Historial por IP</button>
  <button data-tab="messages">ğŸ’¬ Historial General</button>
  <button data-tab="custom">ğŸ§  Respuestas Personalizadas</button>
</div>

<main>

  <!-- DASHBOARD -->
  <section id="dashboard" class="tab-content active">
    <h2>ğŸ“Š Dashboard General</h2>

    <div class="cards">

      <div class="card">
        <h3>Total Mensajes</h3>
        <p id="totalMessages">0</p>
      </div>

      <div class="card">
        <h3>Total IPs Ãšnicas</h3>
        <p id="totalIPs">0</p>
      </div>

      <div class="card">
        <h3>Consultas Hoy</h3>
        <p id="todayMessages">0</p>
      </div>

    </div>

    <canvas id="trafficChart"></canvas>
  </section>

  <!-- IP LIST -->
  <section id="ips" class="tab-content">
    <h2>ğŸŒ IPs Conectadas</h2>
    <div id="map" style="height: 400px; margin-bottom: 20px;"></div>

    <table>
      <thead>
        <tr>
          <th>IP</th>
          <th>Mensajes</th>
          <th>Ãšltima vez</th>
          <th>Ciudad</th>
          <th>PaÃ­s</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="ipTable"></tbody>
    </table>
  </section>

  <!-- IP HISTORY -->
  <section id="ipHistory" class="tab-content">
    <h2>ğŸ“œ Historial por IP</h2>
    <input type="text" placeholder="Escribe IP..." id="ipSearch" />
    <button onclick="loadIPHistory()">Buscar</button>
    <div id="ipHistoryBox"></div>
  </section>

  <!-- ORIGINAL MESSAGE HISTORY -->
  <section id="messages" class="tab-content">
    <h2>ğŸ’¬ Historial General</h2>
    <table>
      <thead>
        <tr><th>Rol</th><th>Mensaje</th><th>Fecha</th></tr>
      </thead>
      <tbody id="generalHistory"></tbody>
    </table>
  </section>

  <!-- CUSTOM REPLIES (OLD PANEL) -->
  <section id="custom" class="tab-content">
    <h2>ğŸ§  Respuestas Personalizadas</h2>

    <div class="card">
      <input id="qInput" placeholder="Pregunta" />
      <textarea id="aInput" placeholder="Respuesta"></textarea>
      <input id="kInput" placeholder="Palabras clave (coma separadas)" />
      <button onclick="addCustom()">Agregar</button>
    </div>

    <table>
      <thead>
        <tr><th>Pregunta</th><th>Respuesta</th><th>Keywords</th><th>Eliminar</th></tr>
      </thead>
      <tbody id="customTable"></tbody>
    </table>
  </section>

</main>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="admin.js"></script>

</body>
</html>
