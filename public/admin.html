<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Panel Administrativo INDARELÃN</title>

<link rel="stylesheet" href="admin.css" />

<!-- LEAFLET MAP -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<!-- CHART JS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>

<header>
  <h1>ğŸ“Š Panel Administrativo INDARELÃN</h1>
</header>

<div id="navbar">
  <button data-tab="dashboard">ğŸ“ˆ Dashboard</button>
  <button data-tab="ips">ğŸŒ IPs & GeolocalizaciÃ³n</button>
  <button data-tab="ipHistory">ğŸ“œ Historial por IP</button>
  <button data-tab="messages">ğŸ’¬ Historial General</button>
  <button data-tab="custom">ğŸ§  Respuestas</button>
  <button data-tab="videos">ğŸ¥ Videos</button>
</div>

<main>

  <!-- DASHBOARD -->
  <section id="dashboard" class="tab-content active">
    <h2>ğŸ“Š Dashboard General</h2>

    <div class="cards">

      <div class="card">
        <h3>Total Mensajes</h3>
        <p id="totalMessages">0</p>
      </div>

      <div class="card">
        <h3>Total IPs Ãšnicas</h3>
        <p id="totalIPs">0</p>
      </div>

      <div class="card">
        <h3>Consultas Hoy</h3>
        <p id="todayMessages">0</p>
      </div>

    </div>

    <canvas id="trafficChart"></canvas>
  </section>

  <!-- IP LIST -->
  <section id="ips" class="tab-content">
    <h2>ğŸŒ IPs Conectadas</h2>
    <div id="map" style="height: 400px; margin-bottom: 20px;"></div>

    <table>
      <thead>
        <tr>
          <th>IP</th>
          <th>Mensajes</th>
          <th>Ãšltima vez</th>
          <th>Ciudad</th>
          <th>PaÃ­s</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="ipTable"></tbody>
    </table>
  </section>

  <!-- IP HISTORY -->
  <section id="ipHistory" class="tab-content">
    <h2>ğŸ“œ Historial por IP</h2>
    <input type="text" placeholder="Escribe IP..." id="ipSearch" />
    <button onclick="loadIPHistory()">Buscar</button>
    <div id="ipHistoryBox"></div>
  </section>

  <!-- ORIGINAL MESSAGE HISTORY -->
  <section id="messages" class="tab-content">
    <h2>ğŸ’¬ Historial General</h2>
    <table>
      <thead>
        <tr><th>Rol</th><th>Mensaje</th><th>Fecha</th></tr>
      </thead>
      <tbody id="generalHistory"></tbody>
    </table>
  </section>

  <!-- CUSTOM REPLIES (OLD PANEL) -->
  
<section id="custom" class="tab-content">
  <h2>ğŸ§  Respuestas Personalizadas</h2>

  <div class="grid-2">
    <div class="panel">
      <div class="panel-header">
        <h3>Lista</h3>
        <input id="customSearch" class="input" placeholder="Buscar trigger o keyword..." />
      </div>

      <table class="table">
        <thead>
          <tr>
            <th>Trigger</th>
            <th>Tipo</th>
            <th>Prioridad</th>
            <th>Activo</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="customTable"></tbody>
      </table>

      <div class="hint">
        * Las respuestas se evalÃºan por <b>prioridad</b> (mayor primero).
      </div>
    </div>

    <div class="panel">
      <div class="panel-header">
        <h3 id="customFormTitle">Crear / Editar</h3>
        <div class="row">
          <button id="btnNewCustom" class="btn" onclick="newCustom()">â• Nuevo</button>
        </div>
      </div>

      <div class="form">
        <input type="hidden" id="customId" />
        <label>Trigger (pregunta clave)</label>
        <input id="triggerInput" class="input" placeholder="Ej: horario, requisitos, etc." />

        <label>Respuesta (texto)</label>
        <textarea id="responseInput" class="textarea" placeholder="Escribe la respuesta..."></textarea>

        <div class="row">
          <div>
            <label>Palabras clave (separadas por coma)</label>
            <input id="keywordsInput" class="input" placeholder="ej: costo, precio, pago" />
          </div>
          <div>
            <label>Prioridad</label>
            <input id="priorityInput" class="input" type="number" min="1" max="100" value="10" />
          </div>
        </div>

        <div class="row">
          <div>
            <label>Tipo</label>
            <select id="typeInput" class="input" onchange="onTypeChange()">
              <option value="text">Texto</option>
              <option value="video">Video</option>
            </select>
          </div>
          <div class="switch">
            <label><input type="checkbox" id="enabledInput" checked /> Activo</label>
          </div>
        </div>

        <div id="videoBox" class="video-box hidden">
          <div class="row">
            <div>
              <label>Video (subido)</label>
              <select id="videoSelect" class="input"></select>
              <small>Tip: sube videos en la pestaÃ±a ğŸ¥ Videos.</small>
            </div>
            <div>
              <label>O URL externa (YouTube embed)</label>
              <input id="videoUrlInput" class="input" placeholder="https://www.youtube.com/embed/XXXX" />
            </div>
          </div>

          <div class="preview">
            <div id="videoPreview"></div>
          </div>
        </div>

        <div class="row">
          <button class="btn primary" onclick="saveCustom()">ğŸ’¾ Guardar</button>
          <button class="btn danger" id="btnDeleteCustom" onclick="deleteCustom()" style="display:none;">ğŸ—‘ï¸ Eliminar</button>
        </div>

        <div class="hint" id="permHint"></div>
      </div>
    </div>
  </div>
</section>



  <section id="videos" class="tab-content">
    <h2>ğŸ¥ Biblioteca de Videos</h2>

    <div class="grid-2">
      <div class="panel">
        <div class="panel-header">
          <h3>Subir video (MP4/WebM, mÃ¡x 50MB)</h3>
        </div>

        <div class="form">
          <input type="file" id="videoFile" accept="video/mp4,video/webm,video/ogg" class="input" />
          <button class="btn primary" onclick="uploadVideo()">â¬†ï¸ Subir</button>
          <div class="hint">Los roles <b>editor</b> y <b>super</b> pueden subir. Solo <b>super</b> puede eliminar.</div>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header">
          <h3>Videos subidos</h3>
        </div>
        <table class="table">
          <thead>
            <tr><th>Nombre</th><th>Fecha</th><th>Acciones</th></tr>
          </thead>
          <tbody id="videosTable"></tbody>
        </table>
      </div>
    </div>

    <div class="panel">
      <div class="panel-header"><h3>Vista previa</h3></div>
      <div id="videoLibraryPreview" class="preview"></div>
    </div>
  </section>

</main>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="admin.js"></script>

</body>
</html>
